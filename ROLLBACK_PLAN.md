# 롤백 계획

이 문서는 배포된 버전에 문제가 발생했을 때 이전 안정 버전으로 롤백하는 절차를 정의합니다.

## 🚨 롤백 조건

다음 상황에서 롤백을 고려합니다:

### 즉시 롤백
- **크래시율 5% 이상**: 많은 사용자가 앱이 종료되는 경우
- **데이터 손실 위험**: 사용자 데이터가 손실될 가능성이 있는 경우
- **보안 취약점 발견**: 심각한 보안 문제가 발견된 경우
- **핵심 기능 작동 불가**: 앱의 핵심 기능이 완전히 작동하지 않는 경우

### 롤백 고려
- **사용자 불만 급증**: 앱스토어 리뷰가 급격히 나빠진 경우
- **성능 저하**: 앱이 심각하게 느려진 경우
- **UI/UX 문제**: 사용자가 앱을 사용하기 어려운 경우

---

## 📋 롤백 절차

### 1단계: 문제 확인 및 평가

```bash
# 1. 에러 로그 확인
- Firebase Crashlytics (사용 시)
- 앱스토어/플레이스토어 크래시 리포트
- 사용자 피드백 확인

# 2. 문제 심각도 평가
- 영향받는 사용자 수
- 문제의 심각도
- 즉시 수정 가능 여부
```

**체크리스트**:
- [ ] 에러 로그 확인 완료
- [ ] 문제 원인 파악
- [ ] 영향 범위 확인
- [ ] 롤백 필요성 판단

---

### 2단계: 이전 안정 버전 확인

```bash
# 모든 태그 확인
git tag -l

# 최근 태그 확인
git tag -l --sort=-version:refname | head -5

# 특정 태그 정보 확인
git show v1.0.0
```

**체크리스트**:
- [ ] 이전 안정 버전 확인 (예: v1.0.0)
- [ ] 해당 버전의 변경사항 확인
- [ ] 롤백 후 영향 범위 확인

---

### 3단계: 롤백 실행

#### 방법 1: Hotfix 브랜치로 롤백 (권장)

```bash
# 1. master에서 hotfix 브랜치 생성
git checkout master
git pull origin master
git checkout -b hotfix/rollback-to-v1.0.0

# 2. 이전 안정 버전으로 체크아웃
git checkout v1.0.0

# 3. 버전 업데이트 (롤백 버전)
# pubspec.yaml: version: 1.0.1+1
# (PATCH 버전 증가, BUILD는 1로 리셋)

# 4. 버전 업데이트 커밋
git add pubspec.yaml
git commit -m "chore: rollback to v1.0.0 due to critical bug in v1.1.0

- Critical bug: [문제 설명]
- Rollback to stable version v1.0.0
- New version: v1.0.1"

# 5. master에 머지
git checkout master
git merge hotfix/rollback-to-v1.0.0 --no-ff
git tag -a v1.0.1 -m "Hotfix: Rollback to v1.0.0

- Critical bug in v1.1.0
- Reverted to stable v1.0.0
- Issue: [문제 설명]"
git push origin master
git push origin v1.0.1

# 6. develop에도 머지
git checkout develop
git merge hotfix/rollback-to-v1.0.0
git push origin develop

# 7. hotfix 브랜치 삭제
git branch -d hotfix/rollback-to-v1.0.0
git push origin --delete hotfix/rollback-to-v1.0.0
```

**체크리스트**:
- [ ] Hotfix 브랜치 생성
- [ ] 이전 버전으로 체크아웃
- [ ] 버전 업데이트
- [ ] master에 머지
- [ ] 태그 생성
- [ ] develop에 머지
- [ ] 브랜치 삭제

---

### 4단계: 롤백 빌드 및 배포

```bash
# 1. 롤백 버전 빌드
flutter build apk --release
flutter build appbundle --release

# 2. 빌드 검증
# - 앱이 정상적으로 실행되는지 확인
# - 핵심 기능이 작동하는지 확인

# 3. 앱스토어/플레이스토어 업로드
# - Google Play Console
# - App Store Connect

# 4. 긴급 배포 요청
# - 플레이스토어: 긴급 배포 요청
# - 앱스토어: 긴급 리뷰 요청
```

**체크리스트**:
- [ ] 롤백 버전 빌드
- [ ] 빌드 검증 완료
- [ ] 앱스토어 업로드
- [ ] 플레이스토어 업로드
- [ ] 긴급 배포 요청
- [ ] 배포 완료 확인

---

### 5단계: 문제 분석 및 재배포 계획

```bash
# 1. 문제 원인 분석
# - 버그 리포트 확인
# - 코드 리뷰
# - 테스트 케이스 확인

# 2. 수정 작업
# - 버그 수정
# - 테스트 추가
# - 재검증

# 3. 재배포 계획
# - 수정 버전 계획 (예: v1.1.1)
# - 배포 일정 수립
```

**체크리스트**:
- [ ] 문제 원인 파악
- [ ] 수정 작업 완료
- [ ] 테스트 완료
- [ ] 재배포 계획 수립

---

## 📝 롤백 시나리오 예시

### 시나리오 1: 크래시 발생

```
상황:
- v1.1.0 배포 후 크래시율 10% 발생
- 많은 사용자 영향

절차:
1. 문제 확인: 특정 화면에서 크래시 발생
2. 이전 버전 확인: v1.0.0 (안정적)
3. 롤백 실행: hotfix/rollback-to-v1.0.0
4. 버전 업데이트: 1.0.1+1
5. 빌드 및 배포: 긴급 배포
6. 문제 분석: v1.1.0의 특정 기능 문제
7. 수정 후 재배포: v1.1.1
```

### 시나리오 2: 데이터 손실 위험

```
상황:
- v1.1.0에서 사용자 데이터가 삭제될 위험 발견
- 즉시 롤백 필요

절차:
1. 즉시 롤백 결정
2. v1.0.0으로 롤백
3. 긴급 배포
4. 사용자 공지
5. 문제 수정 후 재배포
```

---

## ⚠️ 롤백 시 주의사항

### 1. 데이터 호환성
- 이전 버전과 현재 버전의 데이터 형식이 다를 수 있음
- 롤백 시 데이터 마이그레이션 필요 여부 확인

### 2. 사용자 공지
- 롤백 시 사용자에게 공지 필요
- 문제 상황과 해결 계획 안내

### 3. 재배포 계획
- 롤백은 임시 조치
- 문제 수정 후 재배포 계획 수립

### 4. 태그 관리
- 롤백 시에도 새 버전 태그 생성
- 버전은 항상 증가 (v1.0.1)

---

## 🔄 롤백 후 재배포

### 수정 후 재배포 프로세스

```
1. 문제 수정
   - 버그 수정
   - 테스트 추가

2. 버전 업데이트
   - 원래 버전의 PATCH 증가
   - 예: v1.1.0 → v1.1.1

3. 배포
   - release/v1.1.1 브랜치 생성
   - 테스트 완료
   - master에 머지
   - 배포
```

---

## 📊 롤백 이력 관리

롤백이 발생한 경우 다음 정보를 기록합니다:

- **롤백 날짜**: 2024-01-20
- **롤백 전 버전**: v1.1.0
- **롤백 후 버전**: v1.0.1
- **롤백 사유**: 크래시율 10% 발생
- **영향 범위**: 전체 사용자의 30%
- **롤백 담당자**: 개발팀
- **재배포 계획**: v1.1.1로 수정 후 재배포 예정

---

## 🚀 빠른 롤백 체크리스트

긴급 상황 시 빠르게 참고:

```
□ 문제 확인 및 심각도 평가
□ 이전 안정 버전 확인 (git tag -l)
□ Hotfix 브랜치 생성
□ 이전 버전으로 체크아웃
□ 버전 업데이트 (PATCH 증가)
□ master에 머지 및 태그 생성
□ 빌드 및 배포
□ 사용자 공지
□ 문제 분석 및 재배포 계획
```

---

## 📚 참고 자료

- [BRANCH_STRATEGY.md](./BRANCH_STRATEGY.md) - Hotfix 브랜치 사용법
- [VERSION_MANAGEMENT.md](./VERSION_MANAGEMENT.md) - 버전 관리 규칙

